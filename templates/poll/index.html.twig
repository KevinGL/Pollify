{% extends 'base.html.twig' %}

{% block title %}Liste des sondages{% endblock %}

{% block body %}
<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 px-4 py-8">

    <div class="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
        <h1 class="text-4xl font-extrabold text-gray-800 flex-1 text-center md:text-left">Sondages Pollify</h1>
        <img src="/images/undraw_setup-analytics_ttg5.svg" alt="Illustration sondages" class="w-40 md:w-64 h-auto">
    </div>

    <div class="flex justify-center mb-6 space-x-2">
        {% for i in 1..nbPages %}
            <a href="{{ url('app_poll', {'page': i}) }}"
               class="px-3 py-1 rounded {{ i == currentPage ? 'bg-indigo-600 text-white' : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-100' }}">
               {{ i }}
            </a>
        {% endfor %}
    </div>

    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {% for poll in polls %}
        <div class="bg-gradient-to-br from-indigo-100 to-purple-100 shadow-lg rounded-2xl p-6 flex flex-col justify-between transform hover:scale-105 transition">
            
            <div>
                <h2 class="text-xl font-bold text-gray-800 mb-2">{{ poll.title }}</h2>
                <p class="text-gray-700 mb-3">{{ poll.description }}</p>
                <p class="text-sm text-gray-600 mb-1">Début : {{ poll.beginAt | date("d/m/Y") }}</p>
                <p class="text-sm text-gray-600 mb-1">Fin : {{ poll.endAt | date("d/m/Y") }}</p>
                <p class="text-sm text-gray-600 mb-3">Créé par : {{ poll.user.username }}</p>
            </div>

            {% if "ROLE_ADMIN" in app.user.roles or poll.user == app.user %}
            <div class="flex justify-between mt-4">
                <button id="{{ poll.id }}" class="delete-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4m-4 0a1 1 0 00-1 1v1h6V4a1 1 0 00-1-1m-4 0h4" />
                    </svg>
                    Supprimer
                </button>

                <div class="space-x-2">
                    {% if poll.beginAt | date("U") >= "now" | date("U") %}
                        <a href="{{ url('edit_poll', {'id': poll.id}) }}"
                           class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded text-sm flex items-center gap-1">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5h6M11 9h6M11 13h6M5 5h.01M5 9h.01M5 13h.01" />
                           </svg>
                           Modifier
                        </a>
                    {% endif %}
                    <a href="{{ url('view_poll', {'id': poll.id}) }}"
                       class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm flex items-center gap-1">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 11V5a1 1 0 011-1h2a1 1 0 011 1v6m-4 4h4m0 0h4m-4 0v4m0-4v-4" />
                       </svg>
                       Détails
                    </a>
                </div>
            </div>
            {% endif %}

        </div>
        {% endfor %}
    </div>

    <div class="flex justify-center mt-8 space-x-2">
        {% for i in 1..nbPages %}
            <a href="{{ url('app_poll', {'page': i}) }}"
               class="px-3 py-1 rounded {{ i == currentPage ? 'bg-indigo-600 text-white' : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-100' }}">
               {{ i }}
            </a>
        {% endfor %}
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm text-center">
            <p class="mb-4 font-medium text-gray-800">Confirmer la suppression ?</p>
            <div class="flex justify-center gap-4">
                <button id="delete_yes" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Oui</button>
                <button id="delete_no" class="bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded">Non</button>
            </div>
        </div>
    </div>

</div>

<script>
    const modal = document.getElementById("modal");
    const buttons = Array.from(document.getElementsByClassName("delete-btn"));
    let idDelete;

    buttons.map((b) =>
    {
        b.addEventListener("click", () =>
        {
            modal.classList.remove("hidden");
            idDelete = b.id
        });
    });

    document.getElementById("delete_yes").addEventListener("click", () =>
    {
        window.location.href = "/poll/delete/" + idDelete;
    });

    document.getElementById("delete_no").addEventListener("click", () =>
    {
        modal.classList.add("hidden");
    });
</script>

{% endblock %}
