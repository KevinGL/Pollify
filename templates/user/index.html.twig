{% extends 'base.html.twig' %}

{% block title %}Liste des utilisateurs{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-50 px-4 py-8">
    <div class="max-w-6xl mx-auto bg-white shadow-xl rounded-2xl p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Liste des utilisateurs</h1>

        <div class="overflow-x-auto">
            <table class="min-w-full border border-gray-200 divide-y divide-gray-200">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-4 py-2 text-left text-gray-600">ID</th>
                        <th class="px-4 py-2 text-left text-gray-600">Username</th>
                        <th class="px-4 py-2 text-left text-gray-600">Admin ?</th>
                        <th class="px-4 py-2 text-left text-gray-600">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for user in users %}
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-2">{{ user.id }}</td>
                            <td class="px-4 py-2">{{ user.username }}</td>
                            <td class="px-4 py-2">{{ "ROLE_ADMIN" in user.roles ? "Oui" : "Non" }}</td>
                            <td class="px-4 py-2 flex gap-2 flex-wrap">
                                {% if "ROLE_ADMIN" in user.roles %}
                                    <a href="{{ url('unset_admin', {'id': user.id}) }}" class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition">
                                        Retirer admin
                                    </a>
                                {% else %}
                                    <a href="{{ url('set_admin', {'id': user.id}) }}" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition">
                                        Promouvoir admin
                                    </a>
                                {% endif %}
                                <button id="{{ user.id }}" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition buttons_delete">
                                    Supprimer
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-6 flex justify-center gap-2">
            {% for i in 1..nbPages %}
                <a href="{{ url('app_user', {'page': i}) }}" class="px-3 py-1 border rounded {{ i == currentPage ? 'bg-indigo-600 hover:bg-indigo-700 text-white' : 'bg-white hover:bg-gray-100' }}">{{ i }}</a>
            {% endfor %}
        </div>
    </div>
</div>

<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded-xl shadow-lg max-w-sm w-full text-center">
        <p class="mb-4 font-semibold">Confirmer la suppression de cet utilisateur ?</p>
        <div class="flex justify-around gap-4">
            <button id="delete_yes" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">Oui</button>
            <button id="delete_no" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400 transition">Non</button>
        </div>
    </div>
</div>

<script>
    const modal = document.getElementById("modal");
    const buttons = Array.from(document.getElementsByClassName("buttons_delete"));
    let idDelete;

    buttons.map((b) =>
    {
        b.addEventListener("click", () =>
        {
            modal.classList.remove("hidden");
            idDelete = b.id;
        });
    });

    document.getElementById("delete_yes").addEventListener("click", () =>
    {
        window.location.href = "/users/delete/" + idDelete;
    });

    document.getElementById("delete_no").addEventListener("click", () =>
    {
        modal.classList.add("hidden");
    });
</script>

{% endblock %}